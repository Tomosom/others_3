# 缓冲区操作

- Qt中缓冲区的概念
    - 缓冲区的本质为一段连续的存储空间
    - QBuffer是Qt中缓冲区相关的类
    - 在Qt中可以将缓冲区看作一种特殊的IO设备
    - 文件流辅助类可以直接用于操作缓冲区

- QBuffer缓冲区的使用方式

```c
QByteArray array;
QBuffer buffer(&array);

if( buffer.open(QIODevice::WriteOnly) )
{
    QDataStream out(&buffer);
    out << QString ("D.T.Software");
    out << 3.14;
    buffer.close();
}
```
- QBuffer缓冲区的使用场合
    1. 在线程间进行不同类型的数据传递
    2. 缓存外部设备中的数据返回
    3. 数据读取速度小于数据写入速度

# 编程实验 缓冲区操作

# 目录操作

- QDir 是Qt中功能强大的目录操作类
    - Qt 中的目录分隔符统一使用'/'
    - QDir 能够对目录进行任意操作（创建，删除，重命名）
    - QDir 能够获取指定目录中的所有条目（文件和文件夹）
    - QDir 能够使用过滤字符串获取指定条目
    - QDir 能够获取系统中的所有根目录

- 目录操作基础示例

```c
const char* PATH = "C:/Users/hp/Desktop/QDir";
QDir dir;
if( !dir.exists(PATH) )
{
    dir.mkdir(PATH);
}
if( dir.exists(PATH) )
{
    dir.cd(PATH);
    QStringList list = dir.entryList();
    for(int i=0; i<list.count(); i++)
    { /* Dir Operation */ }
}
```

# 编程实验 目录操作示例

# 文件系统监视器
- QFileSystemWatcher用于监控文件和目录的状态变化
    - 能够监控特定目录和文件的状态
    - 能够同时对多个目录和文件进行监控
    - 当目录或者文件发生改变时将触发信号
    - 可以通过信号与槽的机制捕捉信号并做出响应

- 文件监控示例

```c
// 1.定义槽函数，监控状态变化
void Watcher::statusChanged(const QString& path)
{
    /* do something for the status change */
}
// 2.连接状态信号到槽函数
Watcher::Watcher(QObject* parent) : QObject(parent)
{
    connect(&m_watcher, SIGNAL(fileChanged(const QString&)), ...);
    connect(&m_watcher, SIGNAL(directoryChanged(const QString&)), ...);
}
// 3.加入受监控的文件或者目录
void Watcher::addPath(QString path)
{
    m_watcher.addPath(path);
}
```

# 编程实验 文件监控示例

# 小结
- 缓冲区的本质为一段连续的内存空间
- 在Qt中可以将缓冲区看作一种特殊的IO设备
- QDir提供了强大的目录操作支持
- QFileSystemWatcher 能够监控文件和目录的状态变化