深入解析视图与委托
-  一个实例的分析与改进
![](_v_images_/.png)
思考：
如何改进程序界面使其拥有更好的用户体验？

- 改进思路
将Progress从纯文本的显示方式改变为进度
条+文本显示的方式；可以直观的让用户感受
到当前的任务进度。

- 解决方案
1♦ 自定义新的委托类
2♦ 在paint成员函数中绘制进度条显示方式
孓在editorEvent成员函数中禁止数据编辑操作

- 在paint成员函数中绘制进度条显示
if( index.data().type() == QVariant::Int )
{ —
int progress = index, data (). tolnt () ; /* 获取进度数据 */
QStyleOptionPirogiressBai: pi:ogi:essBai:Option;
"设懲会制微* /
progressBarOption.rect = option.rect;
progressBarOption.minimum = 0;
pi:ogi:essBai:Option. maximum = 100;
progressBarOption.progress = progress;
/ *绘制进度条显示* /
QApplication: : style () ->di:awControl (QStyle: : CE_Pi:ogi:essBai:,
&progressBarOption,
painter);
}

- 在editorEvent成员函数中禁止数据编辑操作
bool ret = true;
if ( event->type () != QEvent: :MouseButtonDblClick:
ret = QltemDelegate::editorEvent(event,
model,
option,
index);
return ret;
委托中编辑器的双击事件将触发委tt进入数据编辑状态。

编程实验 视图中的进度条显示

- 任务进度模拟
1.定义计时器用于模拟任务进度
2*定义计时器槽函数void timerTimeout()
孓在槽函数中修改模型中的数据

编程实验 任务进度模拟

- 实例扩展
在实际工程项目中，可以使用后台线程根据实
际的任务情况更新模型中的数据，从而更新数
据的界面显示。

小结
- 自定义视图数据显示的方法
void CustomizedltemDelegate : :paint( ... ) const
{
if( /*數据项满足自定义显示条件V ) {
// 1. t尉匡索引参數获取模型中的數据 // 2 - 定义绘制参数对象
QStyleOptionXXXX xxxxOption;
// 3 •设置具体参數至丨」xxxxOption对象
// 4 •根据参數对象xxxxOption绘制數据显示方式
QApplication::style()->drawControl(QStyle::CE_XXXX,
sxxxxOption,
painter);
}
else
{
QltemDelegate::paint(painter, option, index);
}
}


