线程的生命期问题
-  一个工程中的实际冋题
C++对象有生命周期；
线程也有生命周期；
QThread对象的生命周期与对应的纟舒 命周期是否一"致？
- 工程实践中的经验准则
线程对象生命周期 > 对应的线程生命周期
含舒 13付象生命周期
对应的命周期
- 下面的代码有问题吗？
class MyThread : public QThread {
protected:
int i;
void func()
MyThread t;
t.start();
void run() {
this->i = 1;
for(int i=0; i<5; i++) {
this->i *= 2;
sleep(l)j
编程实验 线程生命期冋题 82-1.pro
- 同步型线程设计
-概念
•线程对象主动等待线程生命期结束后才销毀
-特点
•同时支持在栈和堆中创建线程对象
•对象销毀时确保线程生命期结束
-要点
•在析构函数中先调用wait()函数，强制等到线程运行结束
-使用场合
•线程生命期相对较短的情形
SyncThread::~5yncThnead()
{
wait();
// do something to release resource
}
编程实验 同步型线程设计 82-l.pro
- 异步型线程设计
-概念
•线程生命期结束时通知销毀线程对象
-特点
•只能在堆中创建线程对象
•线程对象不能被外界主动销毀
- 异步型线程设计
-要点
•在run〇中最后调用deleteLater〇函数
•线程体函数主动申请销毀线程对象
-使用场合
•线程生命期不可控，需要长时间运行于后台的情形
- 异步型线程设计
void AsyncThread::run()
{
for(int i=0; i<5; i++)
{
// do something complicated
}
// apply to destory thread object
deleteLater();
编程实验
小结
异步型线程设计 82-1.pro
- 线程对象生命期必须大于对应线程生命期
- 同步型线程设计-线程生命期较短
- 异步型线程设计-线程生命期不可控
- 线程类的设计必须适应具体的场合
- 没有万能的设计，只有合适的设计